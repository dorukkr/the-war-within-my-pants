<!-- apply.html (final with validation) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Apply — The War Within My Pants</title>
  <meta name="description" content="Apply to The War Within My Pants — WoW guild recruitment form." />
  <meta name="theme-color" content="#0b0f17" />

  <!-- Yazı tipleri ve stil -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <style>
    .error-message {
      color: #ff6b6b;
      font-size: 0.85rem;
      margin-top: 4px;
    }
    .field input:invalid,
    .field select:invalid,
    .field textarea:invalid {
      border-color: #ff6b6b;
    }
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>

  <!-- Üst bar -->
  <header class="topbar" role="banner">
    <div class="brand">
      <span class="logo-dot" aria-hidden="true"></span> TWWMP
    </div>
    <nav class="nav" aria-label="Primary">
      <a href="/home">Home</a>
      <a href="/members">Members</a>
      <a href="/raids">Raids</a>
      <a href="/media">Media</a>
      <a class="button small" target="_blank" rel="noopener noreferrer" href="https://discord.gg/Zm7QF9D5DS">Discord</a>
    </nav>
  </header>

  <main id="main">
    <!-- Hero -->
    <section id="apply-hero" class="parallax-bg" style="min-height:48vh; padding-top:120px; background-image:url('images/raid.jpg');">
      <div class="content-box" style="text-align:center;">
        <h1>Apply to The War Within My Pants</h1>
        <p>Fill out this form to join our guild. Your answers will be sent directly to the officers on Discord.</p>
        <p style="margin-top:8px;"><a href="index.html" class="button small">← Back to Home</a></p>
      </div>
    </section>

    <!-- FORM -->
    <section id="apply" class="parallax-bg" aria-label="Guild application form" style="background-image:url('images/media.jpg');">
      <div class="content-box fade-in" style="max-width:860px; width:min(92vw,860px); text-align:left;">
        <h2 style="text-align:center;">Application Form</h2>

        <form id="applyForm" novalidate>
          <input type="text" name="website" id="website" autocomplete="off" tabindex="-1" aria-hidden="true" style="position:absolute; left:-9999px;">

          <div class="form-grid">
            <div class="field">
              <label for="character">Character Name<span class="req">*</span></label>
              <input id="character" name="character" required placeholder="Example: Toxarica, Chop" />
            </div>

            <div class="field">
              <label for="realm">Realm<span class="req">*</span></label>
              <input id="realm" name="realm" required placeholder="Ragnaros (EU)" />
            </div>

            <div class="field">
              <label for="btag">BattleTag<span class="req">*</span></label>
              <input id="btag" name="btag" required placeholder="Name#1234" />
            </div>

            <div class="field">
              <label for="class">Class <span class="req">*</span></label>
              <select id="class" name="class" multiple required>
                <option>Death Knight</option>
                <option>Demon Hunter</option>
                <option>Druid</option>
                <option>Evoker</option>
                <option>Hunter</option>
                <option>Mage</option>
                <option>Monk</option>
                <option>Paladin</option>
                <option>Priest</option>
                <option>Rogue</option>
                <option>Shaman</option>
                <option>Warlock</option>
                <option>Warrior</option>
              </select>
              <small class="hint">Hold CTRL (Windows) or CMD (Mac) to select multiple classes if you also play alts.</small>
            </div>
          </div>

          <div class="field">
            <label for="role">Preferred Roles <span class="req">*</span></label>
            <div class="chips">
              <label><input type="checkbox" name="role" value="Tank"> Tank</label>
              <label><input type="checkbox" name="role" value="Healer"> Healer</label>
              <label><input type="checkbox" name="role" value="DPS"> DPS</label>
            </div>
          </div>

          <div class="form-grid">
  <div class="field">
    <label for="rio">Raider.IO link <span class="req">*</span></label>
    <input id="rio" name="rio" type="url" required
           placeholder="https://raider.io/characters/eu/..." />
  </div>

  <div class="field">
    <label for="wcl">Warcraft Logs link <span class="req">*</span></label>
    <input id="wcl" name="wcl" type="url" required
           placeholder="https://www.warcraftlogs.com/character/..." />
  </div>
</div>


          <div class="field">
            <label for="availability">Raid Times Availability<span class="req">*</span></label>
            <textarea id="availability" name="availability" rows="2" required placeholder="Example: Wed & Sun — 20:30 server; usually available."></textarea>
          </div>

          <div class="field">
            <label for="notes">Anything else we should know?</label>
            <textarea id="notes" name="notes" rows="3" placeholder="Optional: offspec, experience, M+ score, goals…"></textarea>
          </div>

          <div class="agree">
            <label><input type="checkbox" id="consent" required> I agree that my answers will be shared with the officers on Discord.</label>
          </div>

          <div class="actions">
            <button type="submit" class="button-3d pressable"><span>Submit Application</span></button>
            <span id="applyStatus" role="status" aria-live="polite"></span>
          </div>
        </form>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      <div class="footer-left">© <span id="year"></span> The War Within My Pants</div>
      <ul class="footer-links">
        <li><a href="https://discord.gg/Zm7QF9D5DS" target="_blank">Discord</a></li>
        <li><a href="https://raider.io/" target="_blank">Raider.IO</a></li>
        <li><a href="https://www.warcraftlogs.com/" target="_blank">Warcraft Logs</a></li>
        <li><a href="/home">Back to top</a></li>
      </ul>
    </div>
  </footer>

  <script src="apply.js"></script>

  <!-- Validation script -->
 <script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("applyForm");
  const statusEl = document.getElementById("applyStatus");

  function showError(fieldOrContainer, text) {
    const container =
      fieldOrContainer.closest?.('.field') ||
      fieldOrContainer.closest?.('.agree') ||
      fieldOrContainer.parentNode;
    const msg = document.createElement('div');
    msg.className = 'error-message';
    msg.textContent = text;
    container.appendChild(msg);
  }

  function isValidUrl(value) {
    try { new URL(value); return true; } catch { return false; }
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // eski hataları sil
    form.querySelectorAll(".error-message").forEach(el => el.remove());
    let valid = true;

    // alanlar
    const character    = document.getElementById("character");
    const realm        = document.getElementById("realm");
    const btag         = document.getElementById("btag");
    const availability = document.getElementById("availability");
    const rio          = document.getElementById("rio");
    const wcl          = document.getElementById("wcl");
    const consent      = document.getElementById("consent");

    // zorunlu metin alanları
    if (!character.value.trim())    { valid = false; showError(character, "This field is required."); }
    if (!realm.value.trim())        { valid = false; showError(realm, "This field is required."); }
    if (!btag.value.trim())         { valid = false; showError(btag, "This field is required."); }
    if (!availability.value.trim()) { valid = false; showError(availability, "This field is required."); }

    // RIO & WCL zorunlu + URL doğrulaması
    if (!rio.value.trim())          { valid = false; showError(rio, "This field is required."); }
    else if (!isValidUrl(rio.value)){ valid = false; showError(rio, "Please enter a valid URL."); }

    if (!wcl.value.trim())          { valid = false; showError(wcl, "This field is required."); }
    else if (!isValidUrl(wcl.value)){ valid = false; showError(wcl, "Please enter a valid URL."); }

    // role: en az bir tane işaretli mi?
    if (form.querySelectorAll("input[name='role']:checked").length === 0) {
      valid = false;
      showError(form.querySelector(".chips"), "Please select at least one role.");
    }

    // consent: işaretli mi?
    if (!consent.checked) {
      valid = false;
      showError(consent, "You must agree before submitting.");
    }

    if (!valid) return;

    // Discord'a gönder (varsa) ve teşekkür sayfasına git
    try {
      if (window.__sendApplicationToDiscord) {
        await window.__sendApplicationToDiscord();
      }
    } catch (err) {
      if (statusEl) statusEl.textContent = 'Could not send to Discord (will still redirect).';
      console.error(err);
    }
    window.location.href = "thank-you.html";
  });
});
</script>


  <!-- Footer yıl -->
  <script>document.getElementById('year').textContent=new Date().getFullYear();</script>

  <script src="script.js"></script>
  <script>document.querySelectorAll('.fade-in').forEach(el => el.classList.add('visible'));</script>
</body>
</html>
